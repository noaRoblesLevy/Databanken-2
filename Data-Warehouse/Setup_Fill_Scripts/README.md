

# Catchem Data Warehouse (DWH) Setup

## Project Overview
This repository contains the SQL and PowerShell scripts required to build, configure, and populate the **Catchem Data Warehouse** (`catchem_dwh`). The project implements a Star Schema design with a central fact table (`Fact_Treasure_Found`) and several dimension tables (`Dim_User`, `Dim_Date`, `Dim_Season`, etc.).

The ETL (Extract, Transform, Load) process uses PostgreSQL's `dblink` extension to fetch data from a source database, transforms it using SQL views and logic, and loads it into the warehouse.

## Prerequisites
* **PostgreSQL**: (Version 16, 17, or 18 recommended).
* **PowerShell**: For running the automation script.
* **Source Database**: A running PostgreSQL database named `catchem` containing the source tables (`treasure`, `treasure_log`, `user_table`, etc.).

## File Manifest

### 1. Automation & Schema Setup
* **`3_1_2_Setup_datawarehouse.ps1`**: A PowerShell script that automates the initialization process. It checks for the SQL file, drops the existing `catchem_dwh` database (if present), creates a fresh one, and executes the table creation script.
* **`3_1_1_Create_tables_datawarehouse.sql`**: Defines the DDL (Data Definition Language) for the warehouse. It creates the following tables:
    * `Dim_Season`, `Dim_Date`, `Dim_User`, `Dim_Rain`, `Dim_Treasure_Type`
    * `Fact_Treasure_Found`
* **`3_Setup_datawarehouse_log.txt`**: An example output log generated by the PowerShell script.

### 2. Source Connection (Extract)
* **`3_2_Create_DBLink.sql`**: Connects the warehouse to the source database (`catchem`) using `dblink`. It creates a set of staging views (`src_country`, `src_city`, `src_user_table`, `src_treasure_log`, etc.) to abstract the remote connection details.

### 3. Data Loading (Transform & Load)
These scripts populate the dimension and fact tables.
* **`3_2_Fill_Dim_Date.sql`**: Generates a calendar dimension derived from the minimum and maximum dates found in the source logs.
* **`3_2_Fill_Dim_Season.sql`**: Populates static season definitions for Northern and Southern hemispheres.
* **`3_2_Fill_Dim_Rain.sql`**: Initializes the rain dimension (currently sets a default "Unknown" category).
* **`3_2_Fill_Dim_User.sql`**: Transforms user data and calculates an **Experience Level** based on log activity:
    * **Expert**: 50+ logs
    * **Intermediate**: 10–49 logs
    * **Beginner**: 1–9 logs
    * **New**: < 1 log
* **`3_2_Fill_Dim_Treasure_Type.sql`**: Aggregates treasure attributes including difficulty, terrain, container size, and the number of stages.
* **`3_2_Fill_Fact_Treasure_Found.sql`**: Populates the main fact table. It includes logic to:
    * Calculate `Duration_Seconds` (Log Time - Session Start).
    * Determine the correct Season based on the specific date and the hemisphere of the city where the treasure was found.

## Installation & Execution Guide

Follow these steps in order to set up the data warehouse.

### Step 1: Initialize Database
1.  Open **`3_1_2_Setup_datawarehouse.ps1`**.
2.  Edit the `$SOURCE_DIR` variable to point to the folder containing your SQL files.
3.  Ensure the paths to your PostgreSQL binaries (`psql.exe`, `createdb.exe`, `dropdb.exe`) are correct for your system.
4.  Run the script in PowerShell. This will create the `catchem_dwh` database and the empty tables.

### Step 2: Establish Source Connection
1.  Open **`3_2_Create_DBLink.sql`**.
2.  **Important:** Find the connection strings (e.g., `dbname=catchem ... password=YOURPASSWORD`) and replace `YOURPASSWORD` with your actual PostgreSQL password.
3.  Execute this script inside the new `catchem_dwh` database to create the source views.

### Step 3: Populate Dimensions
Execute the following scripts in `catchem_dwh` to fill the dimension tables:
1.  `3_2_Fill_Dim_Rain.sql`
2.  `3_2_Fill_Dim_Season.sql`
3.  `3_2_Fill_Dim_Date.sql`
4.  `3_2_Fill_Dim_User.sql`
5.  `3_2_Fill_Dim_Treasure_Type.sql`

### Step 4: Populate Facts
Finally, run the fact loading script. This relies on the dimensions being populated first.
1.  `3_2_Fill_Fact_Treasure_Found.sql`

## Logic Highlights
* **Hemisphere-Aware Seasons**: The `Fact_Treasure_Found` script dynamically assigns seasons. For example, a hunt in December is recorded as "Winter" if the location is Northern, but "Summer" if the location is Southern.
* **Slowly Changing Dimensions**: The `Dim_User` table includes `ValidFromDate`, `ValidToDate`, and `IsCurrent` columns, preparing the schema for tracking historical changes in user data (SCD Type 2).
