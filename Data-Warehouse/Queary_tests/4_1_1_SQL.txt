\o 4_1_1_SQL_log.txt

-- Stap 1: Tel eerst per jaar en seizoen, met seizoenen naar NL genormaliseerd
WITH hunts_per_year_season AS (
    SELECT 
        d.year,
        CASE
            WHEN s.seasonname IN ('Lente', 'Spring') THEN 'lente'
            WHEN s.seasonname IN ('Zomer', 'Summer') THEN 'zomer'
            WHEN s.seasonname IN ('Herfst', 'Autumn', 'Fall') THEN 'herfst'
            WHEN s.seasonname = 'Winter' THEN 'winter'
        END AS season,
        COUNT(ft.treasure_foundid) AS hunts_in_season
        -- Als jullie fact niet 1 rij per Treasurehunt heeft,
        -- vervang dit door COUNT(DISTINCT (...)) op de juiste sleutel(s)
    FROM fact_treasure_found ft
    JOIN dim_date   d ON ft.datesk   = d.datesk
    JOIN dim_season s ON ft.seasonsk = s.seasonsk
    GROUP BY 
        d.year,
        CASE
            WHEN s.seasonname IN ('Lente', 'Spring') THEN 'lente'
            WHEN s.seasonname IN ('Zomer', 'Summer') THEN 'zomer'
            WHEN s.seasonname IN ('Herfst', 'Autumn', 'Fall') THEN 'herfst'
            WHEN s.seasonname = 'Winter' THEN 'winter'
        END
)

-- Stap 2: Gemiddeld aantal hunts per seizoen over alle jaren
SELECT
    season,
    AVG(hunts_in_season)::numeric(10,2) AS avg_treasurehunts
FROM hunts_per_year_season
GROUP BY season
ORDER BY
    CASE season
        WHEN 'lente'  THEN 1
        WHEN 'zomer'  THEN 2
        WHEN 'herfst' THEN 3
        WHEN 'winter' THEN 4
    END;

\o
